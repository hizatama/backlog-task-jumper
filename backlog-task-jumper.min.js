/** Backlog Task Jumper @version 0.0.6 @author hizatama @see https://github.com/hizatama/backlog-task-jumper */
jQuery(function(e){var t,n="/view/%PJ_NAME%-%ISSUE_ID%",i=(e("#navi-home").attr("href")||"").replace("/projects/",""),r=location.protocol,o=location.hostname,u={},s=e("body").attr("class").indexOf("theme-")!==-1;if(i){var a=e('<div id="btj-wrapper" style="display:none;position: fixed;top: 0px;left: 50%;margin-left: -200px;z-index: 1001;width: 400px;background-color: rgba(125, 168, 0, 0.77);text-align: center;padding: 10px;box-sizing: border-box;border-radius: 0 0 5px 5px;">').appendTo("body"),c=e('<input type="number" class="btj-input-box" style="width: 100%;box-sizing: border-box;padding: 7px;">').appendTo(a),p=e('<p id="tbj-issue-title" style="margin-top: 10px;padding: 5px 0;background-color: rgba(249, 248, 227, 0.9);">').appendTo(a),l=function(e){var t=n,r={PJ_NAME:i,ISSUE_ID:e};for(var o in r)t=t.replace("%"+o+"%",r[o],"g");return t},d=function(e){return e.replace(/[０-９]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})},f=function(){p.text(""),a.stop().slideDown(100),c.val("").focus()},x=function(){a.slideUp(100),c.blur()},y=function(e){return/^[\d]+$/.test(e)&&e>0},h=function(e){return r+"//"+o+l(e)},g=function(e,t){return e=d(e),y(e)?void(t?(window.open(h(e)),x()):location.href=h(e)):(x(),!1)},b=function(t){if(p.text(""),t=d(t),!y(t))return!1;if(void 0!==u[t]){var n=u[t];return p.html(n.type+n.title),!1}var i=issueType="";e.ajax({url:h(t),success:function(t){if(s)issueType="["+e(".ticket__header .pill",t).removeClass("pill").get(0).outerHTML+"] ",i=e("#summary .title-group__title-text",t).text();else{var n=e("#issuecard",t);issueType=e(".key .issue-type-name",n).get(0).outerHTML,i=e(".summary span",n).text()}},complete:function(){u[t]={title:i,type:issueType},p.html(issueType+i)}})};c.on("keydown",function(e){switch(e.which){case 27:return x(),!1}}).on("keypress",function(e){switch(e.which){case 10:case 13:return g(this.value,e.ctrlKey),!1}}).on("keyup",function(e){t&&clearTimeout(t);var n=this.value;t=setTimeout(function(){b(n),t=null},200)}),e(document).on("keypress",function(t){switch(t.which){case 35:if(e.contains(a[0],t.target))return x(),!1;if(!e(t.target).is(":input"))return f(),!1}}).on("click",function(t){e.contains(a[0],t.target)||x()})}});