/** Backlog Task Jumper @version 0.0.5 @author hizatama @see https://github.com/hizatama/backlog-task-jumper */
jQuery(function(t){var e,n="/view/%PJ_NAME%-%ISSUE_ID%",i=(t("#navi-home").attr("href")||"").replace("/projects/",""),o=location.protocol,r=location.hostname,u={};if(i){var a=t('<div id="btj-wrapper" style="display:none;position: fixed;top: 0px;left: 50%;margin-left: -200px;z-index: 1001;width: 400px;background-color: rgba(125, 168, 0, 0.77);text-align: center;padding: 10px;box-sizing: border-box;border-radius: 0 0 5px 5px;">').appendTo("body"),c=t('<input type="number" class="btj-input-box" style="width: 100%;box-sizing: border-box;padding: 7px;">').appendTo(a),s=t('<p id="tbj-issue-title" style="margin-top: 10px;padding: 5px 0;background-color: rgba(249, 248, 227, 0.9);">').appendTo(a),p=function(t){var e=n,o={PJ_NAME:i,ISSUE_ID:t};for(var r in o)e=e.replace("%"+r+"%",o[r],"g");return e},d=function(t){return t.replace(/[０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})},l=function(){s.text(""),a.stop().slideDown(100),c.val("").focus()},f=function(){a.slideUp(100),c.blur()},h=function(t){return/^[\d]+$/.test(t)&&t>0},x=function(t){return o+"//"+r+p(t)},y=function(t,e){return t=d(t),h(t)?void(e?(window.open(x(t)),f()):location.href=x(t)):(f(),!1)},g=function(e){if(s.text(""),e=d(e),!h(e))return!1;if(void 0!==u[e]){var n=u[e];return s.html(n.type+n.title),!1}var i=issueType="";t.ajax({url:x(e),success:function(e){var n=t("#issuecard",e);issueType=t(".key .issue-type-name",n).get(0).outerHTML,i=t(".summary span",n).text()},complete:function(){u[e]={title:i,type:issueType},s.html(issueType+i)}})};c.on("keydown",function(t){switch(t.which){case 27:return f(),!1}}).on("keypress",function(t){switch(t.which){case 10:case 13:return y(this.value,t.ctrlKey),!1}}).on("keyup",function(t){e&&clearTimeout(e);var n=this.value;e=setTimeout(function(){g(n),e=null},200)}),t(document).on("keypress",function(e){switch(e.which){case 35:if(t.contains(a[0],e.target))return f(),!1;if(!t(e.target).is(":input"))return l(),!1}}).on("click",function(e){t.contains(a[0],e.target)||f()})}});